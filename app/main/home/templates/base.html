<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% if title %}
      <title>{{ title }}</title>
    {% else %}
      <title>Aaron's Projects</title>
    {% endif %}
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
  </head>
  <body>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="toast-container">
        {% for category, msg in messages %}
          <div class="toast toast-{{ category }}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}

      <!-- Floating "i" button -->
    <button id="info-btn" class="info-btn">i</button>

    <!-- Popup menu when clicking "i" -->
    <div id="info-menu" class="info-menu">
      <ul>
        <li><a href="{{ url_for('main.index') }}">Home</a></li>
        {% if current_user.is_authenticated %}
          <li><a href="#">Account Settings</a></li>
          <li><a href="#">Log Out</a></li>
        {% else %}
          <li><a href="#">Log In</a></li>
          <li><a href="#">Register</a></li>
        {% endif %}
      </ul>
    </div>

    <script>
      // Toggle the menu when “i” is clicked, close if clicking elsewhere
      document.addEventListener('click', e => {
        const btn  = document.getElementById('info-btn');
        const menu = document.getElementById('info-menu');
        if (btn.contains(e.target)) {
          menu.classList.toggle('visible');
        } else if (!menu.contains(e.target)) {
          menu.classList.remove('visible');
        }
      });

      // Anywhere the standard modal is used (look for "modal-backdrop" and "modal" classes) this script is ran
      document.addEventListener('click', function(e) {
        const openBtn = e.target.closest('[data-open-modal]');
        const closeBtn = e.target.closest('[data-close-modal]');
        const backdrop = e.target.classList.contains('modal-backdrop');

        if (openBtn) {
          const id = openBtn.getAttribute('data-open-modal');
          const modal = document.getElementById(id);
          if (modal) {
            modal.classList.add('open');
            modal.setAttribute('aria-hidden', 'false');
            const focusTarget = modal.querySelector('[data-close-modal]') || modal.querySelector('button, a, [tabindex]');
            focusTarget && focusTarget.focus();
          }
        }

        // Close button
        if (closeBtn) {
          const backdropEl = closeBtn.closest('.modal-backdrop');
          if (backdropEl) {
            backdropEl.classList.remove('open');
            backdropEl.setAttribute('aria-hidden', 'true');
          }
        }

        // Close on clicking outside the modal area
        if (backdrop) {
          e.target.classList.remove('open');
          e.target.setAttribute('aria-hidden', 'true');
        }
      });
    </script>
  </body>